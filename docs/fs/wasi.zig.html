<style type="text/css" >
.more-decls {
    padding-left: 50px;
}
.anal-decl {
 background-color: #F7A41D77;
}
code {
 background-color: #F7A41D77;
}
</style><style type="text/css" >
pre > code {
  display: block;
  overflow: auto;
  padding: 0.5em;
  color: black;
}

details {
  margin-bottom: 0.5em;
  -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
}

.tok {
  color: #333;
  font-style: normal;
}

.code {
  font-family: monospace;
  font-size: 0.8em;
}

.tok-kw {
  color: #333;
  font-weight: bold;
}

.tok-str {
  color: #d14;
}

.tok-builtin {
  color: #0086b3;
}

code.zig {
  color: #777;
  font-style: italic;
}

.tok-fn {
  color: #900;
  font-weight: bold;
}

.tok-null {
  color: #008080;
}

.tok-number {
  color: #008080;
}

.tok-type {
  color: #458;
  font-weight: bold;
}
</style><html><a href="null//fs/wasi.zig"><h1>/fs/wasi.zig</h1></a><div class="more-decls"></div><h2 style="color: orange;">types:</h2><div class="more-decls"><div class="anal-decl"><b>Type-tag of WASI preopen.

WASI currently offers only `Dir` as a valid preopen resource.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">const</span> <span class="tok">PreopenTypeTag</span> <span class="tok tok-symbol">=</span> <span class="tok tok-kw">enum</span></code></pre><details><summary>fields:</summary><div class="md-fields more-decls"><div class="anal-decl"><pre><code class="zig"><span class="tok">Dir</span></code></pre></div></div></details></div><div class="anal-decl"><b>Type of WASI preopen.

WASI currently offers only `Dir` as a valid preopen resource.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">const</span> <span class="tok">PreopenType</span> <span class="tok tok-symbol">=</span> <span class="tok tok-kw">union</span></code></pre><details><summary>fields:</summary><div class="md-fields more-decls"><div class="anal-decl"><b>Preopened directory type.
</b><pre><code class="zig"><span class="tok">Dir</span><span class="tok tok-symbol">:</span> <span class="tok tok-symbol">[</span><span class="tok tok-symbol">]</span><span class="tok tok-kw">const</span> <span class="tok tok-type">u8</span></code></pre></div></div></details><details><summary>funcs</summary><div class="md-funcs more-decls"><div class="anal-decl"><pre><code class="zig"><span class="tok tok-kw">fn</span> <span class="tok tok-fn">eql</span><span class="tok tok-symbol">(</span><span class="tok">self</span><span class="tok tok-symbol">:</span> <span class="tok">Self</span><span class="tok tok-symbol">,</span> <span class="tok">other</span><span class="tok tok-symbol">:</span> <span class="tok">PreopenType</span><span class="tok tok-symbol">)</span> <span class="tok tok-type">bool</span></code></pre></div><div class="anal-decl"><pre><code class="zig"><span class="tok tok-kw">fn</span> <span class="tok tok-fn">format</span><span class="tok tok-symbol">(</span><span class="tok">self</span><span class="tok tok-symbol">:</span> <span class="tok">Self</span><span class="tok tok-symbol">,</span> <span class="tok tok-kw">comptime</span> <span class="tok">fmt</span><span class="tok tok-symbol">:</span> <span class="tok tok-symbol">[</span><span class="tok tok-symbol">]</span><span class="tok tok-kw">const</span> <span class="tok tok-type">u8</span><span class="tok tok-symbol">,</span> <span class="tok">options</span><span class="tok tok-symbol">:</span> <span class="tok">std</span><span class="tok tok-symbol">.</span><span class="tok">fmt</span><span class="tok tok-symbol">.</span><span class="tok">FormatOptions</span><span class="tok tok-symbol">,</span> <span class="tok">out_stream</span><span class="tok tok-symbol">:</span> <span class="tok tok-kw">anytype</span><span class="tok tok-symbol">)</span> <span class="tok tok-symbol">!</span><span class="tok tok-type">void</span></code></pre></div></div></details></div><div class="anal-decl"><b>WASI preopen struct. This struct consists of a WASI file descriptor
and type of WASI preopen. It can be obtained directly from the WASI
runtime using `PreopenList.populate()` method.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">const</span> <span class="tok">Preopen</span> <span class="tok tok-symbol">=</span> <span class="tok tok-kw">struct</span></code></pre><details><summary>fields:</summary><div class="md-fields more-decls"><div class="anal-decl"><b>WASI file descriptor.
</b><pre><code class="zig"><span class="tok">fd</span><span class="tok tok-symbol">:</span> <span class="tok">fd_t</span></code></pre></div><div class="anal-decl"><b>Type of the preopen.
</b><pre><code class="zig"><span class="tok">@&quot;type&quot;</span><span class="tok tok-symbol">:</span> <span class="tok">PreopenType</span></code></pre></div></div></details><details><summary>funcs</summary><div class="md-funcs more-decls"><div class="anal-decl"><b>Construct new `Preopen` instance.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">fn</span> <span class="tok tok-fn">new</span><span class="tok tok-symbol">(</span><span class="tok">fd</span><span class="tok tok-symbol">:</span> <span class="tok">fd_t</span><span class="tok tok-symbol">,</span> <span class="tok">preopen_type</span><span class="tok tok-symbol">:</span> <span class="tok">PreopenType</span><span class="tok tok-symbol">)</span> <span class="tok">Preopen</span> <span class="tok tok-symbol">{</span>
    <span class="tok tok-kw">return</span> <span class="tok">Preopen</span><span class="tok tok-symbol">{</span>
        <span class="tok tok-symbol">.</span><span class="tok">fd</span> <span class="tok tok-symbol">=</span> <span class="tok">fd</span><span class="tok tok-symbol">,</span>
        <span class="tok tok-symbol">.</span><span class="tok">@&quot;type&quot;</span> <span class="tok tok-symbol">=</span> <span class="tok">preopen_type</span><span class="tok tok-symbol">,</span>
    <span class="tok tok-symbol">}</span><span class="tok tok-symbol">;</span>
<span class="tok tok-symbol">}</span></code></pre></div></div></details></div><div class="anal-decl"><b>Dynamically-sized array list of WASI preopens. This struct is a
convenience wrapper for issuing `std.os.wasi.fd_prestat_get` and
`std.os.wasi.fd_prestat_dir_name` syscalls to the WASI runtime, and
collecting the returned preopens.

This struct is intended to be used in any WASI program which intends
to use the capabilities as passed on by the user of the runtime.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">const</span> <span class="tok">PreopenList</span> <span class="tok tok-symbol">=</span> <span class="tok tok-kw">struct</span></code></pre><details><summary>fields:</summary><div class="md-fields more-decls"><div class="anal-decl"><b>Internal dynamically-sized buffer for storing the gathered preopens.
</b><pre><code class="zig"><span class="tok">buffer</span><span class="tok tok-symbol">:</span> <span class="tok">InnerList</span></code></pre></div></div></details><details><summary>funcs</summary><div class="md-funcs more-decls"><div class="anal-decl"><b>Deinitialize with `deinit`.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">fn</span> <span class="tok tok-fn">init</span><span class="tok tok-symbol">(</span><span class="tok">allocator</span><span class="tok tok-symbol">:</span> <span class="tok tok-symbol">*</span><span class="tok">Allocator</span><span class="tok tok-symbol">)</span> <span class="tok">Self</span> <span class="tok tok-symbol">{</span>
    <span class="tok tok-kw">return</span> <span class="tok">Self</span><span class="tok tok-symbol">{</span> <span class="tok tok-symbol">.</span><span class="tok">buffer</span> <span class="tok tok-symbol">=</span> <span class="tok">InnerList</span><span class="tok tok-symbol">.</span><span class="tok">init</span><span class="tok tok-symbol">(</span><span class="tok">allocator</span><span class="tok tok-symbol">)</span> <span class="tok tok-symbol">}</span><span class="tok tok-symbol">;</span>
<span class="tok tok-symbol">}</span></code></pre></div><div class="anal-decl"><b>Release all allocated memory.
</b><pre><code class="zig"><span class="tok tok-kw">fn</span> <span class="tok tok-fn">deinit</span><span class="tok tok-symbol">(</span><span class="tok">pm</span><span class="tok tok-symbol">:</span> <span class="tok">Self</span><span class="tok tok-symbol">)</span> <span class="tok tok-type">void</span></code></pre></div><div class="anal-decl"><b>Populate the list with the preopens by issuing `std.os.wasi.fd_prestat_get`
and `std.os.wasi.fd_prestat_dir_name` syscalls to the runtime.

If called more than once, it will clear its contents every time before
issuing the syscalls.

In the unlinkely event of overflowing the number of available file descriptors,
returns `error.Overflow`. In this case, even though an error condition was reached
the preopen list still contains all valid preopened file descriptors that are valid
for use. Therefore, it is fine to call `find`, `asSlice`, or `toOwnedSlice`. Finally,
`deinit` still must be called!
</b><pre><code class="zig"><span class="tok tok-kw">fn</span> <span class="tok tok-fn">populate</span><span class="tok tok-symbol">(</span><span class="tok">self</span><span class="tok tok-symbol">:</span> <span class="tok tok-symbol">*</span><span class="tok">Self</span><span class="tok tok-symbol">)</span> <span class="tok">Error</span><span class="tok tok-symbol">!</span><span class="tok tok-type">void</span></code></pre></div><div class="anal-decl"><b>Find preopen by type. If the preopen exists, return it.
Otherwise, return `null`.
</b><pre><code class="zig"><span class="tok tok-kw">fn</span> <span class="tok tok-fn">find</span><span class="tok tok-symbol">(</span><span class="tok">self</span><span class="tok tok-symbol">:</span> <span class="tok">Self</span><span class="tok tok-symbol">,</span> <span class="tok">preopen_type</span><span class="tok tok-symbol">:</span> <span class="tok">PreopenType</span><span class="tok tok-symbol">)</span> <span class="tok tok-symbol">?</span><span class="tok tok-symbol">*</span><span class="tok tok-kw">const</span> <span class="tok">Preopen</span></code></pre></div><div class="anal-decl"><b>Return the inner buffer as read-only slice.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">fn</span> <span class="tok tok-fn">asSlice</span><span class="tok tok-symbol">(</span><span class="tok">self</span><span class="tok tok-symbol">:</span> <span class="tok">Self</span><span class="tok tok-symbol">)</span> <span class="tok tok-symbol">[</span><span class="tok tok-symbol">]</span><span class="tok tok-kw">const</span> <span class="tok">Preopen</span> <span class="tok tok-symbol">{</span>
    <span class="tok tok-kw">return</span> <span class="tok">self</span><span class="tok tok-symbol">.</span><span class="tok">buffer</span><span class="tok tok-symbol">.</span><span class="tok">items</span><span class="tok tok-symbol">;</span>
<span class="tok tok-symbol">}</span></code></pre></div><div class="anal-decl"><b>The caller owns the returned memory. ArrayList becomes empty.
</b><pre><code class="zig"><span class="tok tok-kw">pub</span> <span class="tok tok-kw">fn</span> <span class="tok tok-fn">toOwnedSlice</span><span class="tok tok-symbol">(</span><span class="tok">self</span><span class="tok tok-symbol">:</span> <span class="tok tok-symbol">*</span><span class="tok">Self</span><span class="tok tok-symbol">)</span> <span class="tok tok-symbol">[</span><span class="tok tok-symbol">]</span><span class="tok">Preopen</span> <span class="tok tok-symbol">{</span>
    <span class="tok tok-kw">return</span> <span class="tok">self</span><span class="tok tok-symbol">.</span><span class="tok">buffer</span><span class="tok tok-symbol">.</span><span class="tok">toOwnedSlice</span><span class="tok tok-symbol">(</span><span class="tok tok-symbol">)</span><span class="tok tok-symbol">;</span>
<span class="tok tok-symbol">}</span></code></pre></div></div></details><details><summary>values:</summary><div class="md-vals more-decls"><div class="anal-decl"><pre><code class="zig"><span class="tok tok-kw">const</span> <span class="tok">Error</span> <span class="tok tok-symbol">=</span> <span class="tok tok-kw">error</span><span class="tok tok-symbol">{</span> <span class="tok">OutOfMemory</span><span class="tok tok-symbol">,</span> <span class="tok">Overflow</span> <span class="tok tok-symbol">}</span> <span class="tok tok-symbol">||</span> <span class="tok">os</span><span class="tok tok-symbol">.</span><span class="tok">UnexpectedError</span></code></pre></div></div></details></div></div><div class="more-decls"></div><div class="more-decls"></div></html>